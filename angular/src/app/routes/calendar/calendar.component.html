<div class="d-flex justify-content-center mb-2 mt-2">
    <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h3>
    <div class="row ms-2">
        <div class="col-3 d-flex justify-content-center">
            <button pButton pRipple type="button" icon="fas fa-chevron-left" class="p-button-rounded p-button-outlined"
                mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate"
                (viewDateChange)="closeOpenMonthViewDay()"></button>
        </div>
        <div class="col-6 d-flex justify-content-center">
            <button pButton type="p-button-sm" label="Today" mwlCalendarToday [(viewDate)]="viewDate"></button>
        </div>
        <div class="col-3 d-flex justify-content-center">
            <button pButton pRipple type="button" icon="fas fa-chevron-right" class="p-button-rounded p-button-outlined"
                mwlCalendarNextView [view]="view" [(viewDate)]="viewDate"
                (viewDateChange)="closeOpenMonthViewDay()"></button>
        </div>
    </div>
    <div class="row d-flex justify-content-center ms-2">
        <p-dropdown [options]="views" [(ngModel)]="selectedView" (onChange)="selectedViewChanged()"></p-dropdown>
    </div>
</div>

<div [ngSwitch]="selectedView" class="mt-3">
    <div class="col-12">
        <mwl-calendar-month-view *ngSwitchCase="'Month'" [viewDate]="viewDate" [events]="events" [refresh]="refresh"
            [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="dayClicked($event.day)"
            (eventClicked)="handleEvent('Click', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-month-view>
        <mwl-calendar-week-view *ngSwitchCase="'Week'" [viewDate]="viewDate" [events]="events" [refresh]="refresh"
            (eventClicked)="handleEvent('Click', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-week-view>
        <mwl-calendar-day-view *ngSwitchCase="'Day'" [viewDate]="viewDate" [events]="events" [refresh]="refresh"
            (eventClicked)="handleEvent('Click', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-day-view>
        <button type="button" class="float round-button btn btn-primary" (click)="openAddEventModal()">
            <i class="fas fa-3x fa-plus"></i>
        </button>
    </div>
</div>

<div *ngIf="loadingEvents == false; else spinner">
</div>

<p-dialog [(visible)]="displayModifyEventModal" [style]="{width: '40vw'}">
    <ng-template pTemplate="header">
        <h5>Modify Event</h5>
    </ng-template>
    <form [formGroup]="eventForm">
        <div class="form-group mt-2">
            <input class="form-control" id="title" placeholder="Title event" formControlName="title">
        </div>
        <div class="form-group mt-2">
            <textarea [rows]="5" [cols]="30" pInputTextarea placeholder="Event description" formControlName="description"></textarea>
        </div>
        <div class="form-group row mt-2">
            <label>All day</label>
            <div class="checkbox c-checkbox ms-2">
                <label>
                    <input class="resize-checkbox form-control" id="allDay" type="checkbox" formControlName="allDay" />
                </label>
            </div>
            <label>Automatic date</label>
            <div class="checkbox c-checkbox ms-2">
                <label>
                    <input class="resize-checkbox form-control" id="automaticDate" type="checkbox"
                        formControlName="automaticDate" />
                </label>
            </div>
        </div>
        <div class="row" *ngIf="eventForm.value.automaticDate != true">
            <div class="col-6 d-flex align-items-center mt-3">
                <label class="mr-1">From</label>
                <div class="form-group ms-2">
                    <p-calendar formControlName="start" showTime="true" [hourFormat]="24" appendTo="body"></p-calendar>
                </div>
            </div>
            <div class="col-6 d-flex align-items-center mt-3">
                <label class="mr-1">To</label>
                <div class="form-group ms-2">
                    <p-calendar formControlName="end" showTime="true" [hourFormat]="24" appendTo="body"></p-calendar>
                </div>
            </div>
        </div>
        <div class="row mt-2" style="margin-right: 0px;">
            <div class="col-6">
                <p-multiSelect [options]="addedUsers" [(ngModel)]="selectedAddedUsers" optionLabel="name" appendTo="body"></p-multiSelect>
            </div>
        </div>
        <div class="row mt-2" style="margin-right: 0px;">
            <a class="ms-3 mt-1 pointer" href="/available-hours" target="_blank" style="color: blue;"> See available
                hours </a>
        </div>
    </form>
    <ng-template pTemplate="footer">
        <button type="button" class="btn btn-secondary resize-modal-buttons modal-buttons-text-size" (click)="close()">
            Cancel <i class="fas fa-times"></i>
        </button>
        <button type="button" class="btn btn-primary resize-modal-buttons modal-buttons-text-size"
            [disabled]="!eventForm.valid" (click)="editNewEvent(eventForm.value)">
            Save <i class="far fa-save"></i>
        </button>
    </ng-template>
</p-dialog>

<p-dialog [(visible)]="displayAddEventModal" [style]="{width: '40vw'}">
    <ng-template pTemplate="header">
        <h5>Modify Event</h5>
    </ng-template>
    <form [formGroup]="eventForm">
        <div class="form-group mt-2">
            <input class="form-control" id="title" placeholder="Title event" formControlName="title">
        </div>
        <div class="form-group mt-2">
            <textarea [rows]="5" [cols]="30" pInputTextarea placeholder="Event description" formControlName="description"></textarea>
        </div>
        <div class="form-group row mt-2">
            <label>All day</label>
            <div class="checkbox c-checkbox ms-2">
                <label>
                    <input class="resize-checkbox form-control" id="allDay" type="checkbox" formControlName="allDay" />
                </label>
            </div>
            <label>Automatic date</label>
            <div class="checkbox c-checkbox ms-2">
                <label>
                    <input class="resize-checkbox form-control" id="automaticDate" type="checkbox"
                        formControlName="automaticDate" />
                </label>
            </div>
        </div>
        <div class="row" *ngIf="eventForm.value.automaticDate != true">
            <div class="col-6 d-flex align-items-center mt-3">
                <label class="mr-1">From</label>
                <div class="form-group ms-2">
                    <p-calendar formControlName="start" showTime="true" [hourFormat]="24" appendTo="body"></p-calendar>
                </div>
            </div>
            <div class="col-6 d-flex align-items-center mt-3">
                <label class="mr-1">To</label>
                <div class="form-group ms-2">
                    <p-calendar formControlName="end" showTime="true" [hourFormat]="24" appendTo="body"></p-calendar>
                </div>
            </div>
        </div>
        <div class="row mt-2" style="margin-right: 0px;">
            <div class="col-6">
                <p-multiSelect [options]="addedUsers" [(ngModel)]="selectedAddedUsers" optionLabel="name" appendTo="body"></p-multiSelect>
            </div>
        </div>
        <div class="row mt-2" style="margin-right: 0px;">
            <a class="ms-3 mt-1 pointer" href="/available-hours" target="_blank" style="color: blue;"> See available
                hours </a>
        </div>
    </form>
    <ng-template pTemplate="footer">
        <button type="button" class="btn btn-secondary resize-modal-buttons modal-buttons-text-size" (click)="close()">
            Cancel <i class="fas fa-times"></i>
        </button>
        <button type="button" class="btn btn-primary resize-modal-buttons modal-buttons-text-size"
            [disabled]="!eventForm.valid" (click)="saveNewEvent(eventForm.value)">
            Save <i class="far fa-save"></i>
        </button>
    </ng-template>
</p-dialog>

<ng-template #spinner>
    <div>
        <app-spinner></app-spinner>
    </div>
</ng-template>