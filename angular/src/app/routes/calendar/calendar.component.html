<div [ngSwitch]="view" class="mt-3">
    <div class="col-12">
        <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" [viewDate]="viewDate" [events]="events"
            [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="dayClicked($event.day)"
            (eventClicked)="handleEvent('Clicked', $event.event)" (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-month-view>
        <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" [viewDate]="viewDate" [events]="events"
            [refresh]="refresh" (eventClicked)="handleEvent('Clicked', $event.event)"
            (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-week-view>
        <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day" [viewDate]="viewDate" [events]="events"
            [refresh]="refresh" (eventClicked)="handleEvent('Clicked', $event.event)"
            (eventTimesChanged)="eventTimesChanged($event)">
        </mwl-calendar-day-view>
        <button type="button" class="float round-button btn btn-primary" (click)="openAddEventModal()">
            <i class="fas fa-3x fa-plus"></i>
        </button>
    </div>
</div>

<div *ngIf="loadingEvents == false; else spinner">
</div>

<!-- Modify event modl -->
<ng-template #modifyEventModal let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Event action occurred</h5>
        <button type="button" class="close" (click)="close()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div>
            Action:
            <pre>{{ modalData?.action }}</pre>
        </div>
        <div>
            Event:
            <pre>{{ modalData?.event | json }}</pre>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="close()">
            OK
        </button>
    </div>
</ng-template>

<!-- Modal to add new event -->
<ng-template #addNewEventModal let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Add new event</h5>
        <button type="button" class="close" (click)="close()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="addNewEventForm">
            <div class="form-group">
                <input class="form-control" id="title" placeholder="Title event" formControlName="title">
            </div>
            <div class="form-group row ml-1 mt-5">
                <label>All day</label>
                <div class="checkbox c-checkbox ml-2">
                    <label>
                        <input class="resize-checkbox form-control" id="allDay" type="checkbox"
                            formControlName="allDay" />
                    </label>
                </div>
                <label class="ml-5">Automatic date</label>
                <div class="checkbox c-checkbox ml-2">
                    <label>
                        <input class="resize-checkbox form-control" id="automaticDate" type="checkbox"
                            formControlName="automaticDate" />
                    </label>
                </div>
            </div>
            <div class="row" style="margin-right: 0px;" *ngIf="addNewEventForm.value.automaticDate != true">
                <div class="col-6 d-flex align-items-center mt-3">
                    <label class="mr-1">From</label>
                    <div class="form-group ml-2">
                        <div class="input-group">
                            <input class="form-control" placeholder="yyyy-mm-dd" name="dpStart" ngbDatepicker
                                #d1="ngbDatepicker" [(ngModel)]="startDate" formControlName="start">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary calendar" (click)="d1.toggle()"
                                    type="button"><i class="far fa-calendar-alt"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6" *ngIf="addNewEventForm.value.allDay != true">
                    <ngb-timepicker [(ngModel)]="startTime" [ngModelOptions]="{standalone: true}"></ngb-timepicker>
                </div>
            </div>
            <div class="row" style="margin-right: 0px;" *ngIf="addNewEventForm.value.automaticDate != true">
                <div class="col-6 d-flex align-items-center mt-3">
                    <label class="mr-4">To</label>
                    <div class="form-group ml-2">
                        <div class="input-group">
                            <input class="form-control" placeholder="yyyy-mm-dd" name="dpEnd" ngbDatepicker
                                #d2="ngbDatepicker" [(ngModel)]="endDate" formControlName="end">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary calendar" (click)="d2.toggle()"
                                    type="button"><i class="far fa-calendar-alt"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6" *ngIf="addNewEventForm.value.allDay != true">
                    <ngb-timepicker [(ngModel)]="endTime" [ngModelOptions]="{standalone: true}"></ngb-timepicker>
                </div>
            </div>
            <div class="row mt-5" style="margin-right: 0px;">
                <ng-select class="ml-3" [items]="addedUsers" bindLabel="email" [addTag]="true" [multiple]="true"
                    [hideSelected]="true" [trackByFn]="trackByFn" [minTermLength]="0" [loading]="loadingUsers"
                    [typeahead]="addedUserInput" [(ngModel)]="selectedAddedUsers" formControlName="userEmail"
                    style="width: 100%;">
                </ng-select>
                <a class="ml-3 mt-1 pointer" (click)="openAvailableHoursModal()" style="color: blue;"> See available
                    hours </a>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary resize-modal-buttons modal-buttons-text-size" (click)="close()">
            Cancel <i class="fas fa-times"></i>
        </button>
        <button type="button" class="btn btn-primary resize-modal-buttons modal-buttons-text-size"
            [disabled]="!addNewEventForm.valid" (click)="saveNewEvent(addNewEventForm.value)">
            Save <i class="far fa-save"></i>
        </button>
    </div>
</ng-template>



<ng-template #spinner>
    <div>
        <app-spinner></app-spinner>
    </div>
</ng-template>